<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Artwall Archive{% endblock %}</title>
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" 
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" 
          integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" 
          crossorigin="anonymous" 
          referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/themes.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/masonry.css') }}">
</head>
<body data-theme="atelier">
    <div class="navbar-wrapper">
        <nav class="navbar">
            <div class="nav-left">
                <a href="{{ url_for('main.index') }}" class="navbar-title-link">
                    <h1 class="navbar-title">Artwall</h1>
                </a>
            </div>
            <div class="nav-center">
                {% block nav_filters %}{% endblock %}
            </div>
            <div class="nav-right">
                <span class="version-tracker">{{ version }}</span>
                {% block nav_right_extras %}{% endblock %}
                <div class="dropdown-wrapper" id="theme-dropdown-wrapper">
                    <button class="icon-btn" title="Choose theme" onclick="toggleDropdown('theme-dropdown')">
                        <i class="fa-solid fa-palette"></i>
                    </button>
                    <div id="theme-dropdown" class="dropdown" style="display: none;">
                        <div class="dropdown-header">
                            <span class="dropdown-title">Theme</span>
                        </div>
                        <div class="theme-options">
                            <button class="dropdown-btn" onclick="changeTheme('atelier')" data-theme="atelier">
                                <span>Atelier</span>
                                <span class="theme-indicator" style="background: linear-gradient(135deg, #0b8783 0%, #E85D4F 50%, #F4A742 100%);"></span>
                            </button>
                            <button class="dropdown-btn" onclick="changeTheme('blueprint')" data-theme="blueprint">
                                <span>Blueprint</span>
                                <span class="theme-indicator" style="background: linear-gradient(135deg, #1F618D 0%, #2980B9 50%, #16A085 100%);"></span>
                            </button>
                            <button class="dropdown-btn" onclick="changeTheme('dark')" data-theme="dark">
                                <span>Dark</span>
                                <span class="theme-indicator" style="background: linear-gradient(135deg, #17202A 0%, #1E2732 50%, #2C3E50 100%);"></span>
                            </button>
                            <button class="dropdown-btn" onclick="changeTheme('teal')" data-theme="teal">
                                <span>Teal</span>
                                <span class="theme-indicator" style="background: linear-gradient(135deg, #0b8783 0%, #14B8A6 50%, #5EEAD4 100%);"></span>
                            </button>
                            <button class="dropdown-btn" onclick="changeTheme('nature')" data-theme="nature">
                                <span>Nature</span>
                                <span class="theme-indicator" style="background: linear-gradient(135deg, #059669 0%, #10B981 50%, #34D399 100%);"></span>
                            </button>
                            <button class="dropdown-btn" onclick="changeTheme('earth')" data-theme="earth">
                                <span>Earth</span>
                                <span class="theme-indicator" style="background: linear-gradient(135deg, #92400E 0%, #B45309 50%, #D97706 100%);"></span>
                            </button>
                        </div>
                    </div>
                </div>
                <button class="icon-btn" title="App info" onclick="showAppInfo()">
                    <i class="fa-solid fa-circle-info"></i>
                </button>
                {% if current_user.is_authenticated %}
                    <a href="{{ url_for('auth.logout') }}" class="nav-link">Logout</a>
                {% else %}
                    <a href="{{ url_for('auth.login') }}" class="nav-link">Login</a>
                {% endif %}
            </div>
        </nav>
    </div>

    <div class="container">
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            {% for category, message in messages %}
              <div class="alert alert-{{ category }}">{{ message }}</div>
            {% endfor %}
          {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
    </div>

    <!-- Load external libraries -->
    <script src="https://unpkg.com/htmx.org@1.9.0"></script>
    <script src="https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.min.js"></script>
    <script src="https://unpkg.com/imagesloaded@5/imagesloaded.pkgd.min.js"></script>
    <script src="{{ url_for('static', filename='js/gradient.js') }}"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    <script>
        // Global state for tracking open dropdowns
        let openDropdown = null;

        function toggleDropdown(dropdownId) {
            const dropdown = document.getElementById(dropdownId);
            
            // Close any other open dropdown
            if (openDropdown && openDropdown !== dropdown) {
                closeDropdown(openDropdown);
            }
            
            if (dropdown.style.display === 'none') {
                // Open dropdown
                dropdown.style.display = 'flex';
                dropdown.classList.remove('closing');
                openDropdown = dropdown;
            } else {
                // Close dropdown
                closeDropdown(dropdown);
            }
        }

        function closeDropdown(dropdown) {
            if (!dropdown || dropdown.style.display === 'none') return;
            
            dropdown.classList.add('closing');
            
            // Wait for animation to complete
            setTimeout(() => {
                dropdown.style.display = 'none';
                dropdown.classList.remove('closing');
                if (openDropdown === dropdown) {
                    openDropdown = null;
                }
            }, 140);
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            if (!openDropdown) return;
            
            const wrapper = openDropdown.closest('.dropdown-wrapper');
            if (wrapper && !wrapper.contains(event.target)) {
                closeDropdown(openDropdown);
            }
        });

        // Close dropdown when pressing Escape
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape' && openDropdown) {
                closeDropdown(openDropdown);
            }
        });

        // Theme switcher
        function changeTheme(theme) {
            document.body.setAttribute('data-theme', theme);
            localStorage.setItem('artwall-theme', theme);
            
            // Update active state
            document.querySelectorAll('.dropdown-btn[data-theme]').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`.dropdown-btn[data-theme="${theme}"]`)?.classList.add('active');
            
            // Close dropdown
            const dropdown = document.getElementById('theme-dropdown');
            if (dropdown) {
                closeDropdown(dropdown);
            }
        }
        
        // Show app info
        function showAppInfo() {
            alert('Artwall Archive\n\nYour creative work collection.\n\nVersion: {{ version }}');
        }
        
        // Load saved theme on page load
        window.addEventListener('DOMContentLoaded', function() {
            const savedTheme = localStorage.getItem('artwall-theme') || 'atelier';
            document.body.setAttribute('data-theme', savedTheme);
            
            // Set active theme button
            document.querySelectorAll('.dropdown-btn[data-theme]').forEach(btn => {
                if (btn.dataset.theme === savedTheme) {
                    btn.classList.add('active');
                }
            });
        });
    </script>
</body>
</html>