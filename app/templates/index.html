{% extends "base.html" %}

{% block title %}Artwall - Your Creative Archive{% endblock %}

{% block nav_filters %}
<div class="nav-filter-bar">
    <!-- Medium filter icons -->
    <div class="icons-wrapper">
        <button class="icon-btn active" title="All mediums" data-filter="all">
            <i class="fa-solid fa-globe"></i>
        </button>
        <button class="icon-btn" title="Writing" data-filter="writing">
            <i class="fa-solid fa-pen-nib"></i>
        </button>
        <button class="icon-btn" title="Drawing" data-filter="drawing">
            <i class="fa-solid fa-paintbrush"></i>
        </button>
        <button class="icon-btn" title="Audio" data-filter="audio">
            <i class="fa-solid fa-music"></i>
        </button>
        <button class="icon-btn" title="Sculpture" data-filter="sculpture">
            <i class="fa-solid fa-cube"></i>
        </button>
    </div>
    
    <!-- Search bar with icon -->
    <div class="search-wrapper">
        <i class="fa-solid fa-magnifying-glass search-icon"></i>
        <input type="text" id="search-input" class="search-input" placeholder="Search..." oninput="handleSearch(this.value)">
    </div>
</div>
{% endblock %}

{% block content %}
<div class="masonry-container">
    
    {% if error %}
        <div class="error-message">
            <p>Error loading posts: {{ error }}</p>
        </div>
    {% endif %}
    
    <!-- Grid Container with blank columns -->
    <div class="grid" id="grid-container">
        <!-- Left blank column -->
        <div class="grid-item blank-col" aria-hidden="true"></div>
        <!-- Grid Sizer for column width calculation -->
        <div class="grid-sizer"></div>
        {% if grouped_posts %}
            {% from 'components/card.html' import render_card %}
            {% from 'components/year_separator.html' import render_year_separator %}
            {% for year, posts in grouped_posts %}
                {{ render_year_separator(year) }}
                {% for post in posts %}
                    {{ render_card(post) }}
                {% endfor %}
            {% endfor %}
        {% else %}
            <div class="empty-state">
                <p>No posts yet. Start by importing your notes!</p>
                <a href="{{ url_for('ingest.index') }}" class="btn btn-primary">Import ENEX File</a>
            </div>
        {% endif %}
        <!-- Right blank column -->
        <div class="grid-item blank-col" aria-hidden="true"></div>
    </div>
    
    <!-- Load More Trigger -->
    <div id="load-more-container" class="load-more-container">
        {% if next_cursor %}
            <div id="scroll-trigger"
                hx-get="{{ url_for('api.load_more', cursor=next_cursor) }}"
                hx-trigger="intersect once"
                hx-target="#grid-container"
                hx-swap="beforeend">
                <div class="loading-indicator">Laden...</div>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}
